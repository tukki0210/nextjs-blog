---
title: 'Node.jsでESModulesを利用する'
date: '2021-08-24'
image: '/images/2021年/2月/HandsOnNodeJs.jpg'
metaDescription: 'C'
tags: 
- 'JavaScript'
- 'Node.js'
- 'TypeScript'
---

## CommonJSとESModules

JavaScriptのサーバーサイドでの実行環境であるNode.jsは<code>CommmonJS</code>と呼ばれるモジュールシステムを利用しています。

Node.js上でTypeScriptを用いて開発を行おうとするとき、TypeScriptはCommonjsではなくブラウザで動くJavaScriptで使われている
<code>ESModules</code>を使用する必要があります。

Node.jsではv8からESModulesを使用できるようになっていますが、TypeScriptを使わないのであれば現状はCommonJSを使用するのが無難だと思います。


### package.jsonの設定

まずESModulesを扱う場合は、package.jsonの"type"属性 を"module"に設定します。
CommonJSを使う場合は"commonjs"です。

```javascript
{
  "name": "server",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
 "type": "module", <- 

(以下略)
 ```
## CommonJSの特有の機能をESModulesで使う

CommonJSでよく使われるメソッドのうち、ESModulesでは仕様上使えないものがあります。<br>
その対応として、Node.jsではこれらを使うためのAPIを提供しています。


#### require
```javascript
import module from "module";
const require = module.createRequire(import.meta.url);

```

#### __filename と __dirname
```javascript
import { fileURLToPath } from 'url';
import { dirname } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
```

参考：[Node.js Dual Packages (CommonJS/ES Modules) に対応した npm パッケージの開発](https://blog.cybozu.io/entry/2020/10/06/170000#mjs-%E3%81%A8-cjs)
