---
title: 'Laravelで応用情報技術者のデータベース問題を実装する その１'
date: '2021-10-24'
image: '/images/2021年/10月/Laravel.jpg'
metaDescription: Laravelでシステムの実装の練習
tags:
  - 'Laravel'
  - '授業課題の解説'
---


### ホテルの予約システムを作ろう！

応用情報技術者令和２年秋のデータベースの問題を題材にして、Laravelでホテル予約システムを作っていきます。

過去問道場の該当箇所はこちら

[応用情報技術者試験ドットコム　令和２年度秋期　午後問６　データベース](https://www.ap-siken.com/kakomon/02_aki/pm06.html)

まずは要件定義とE-R図については、こんな感じになります。一部簡易にしています。

#### 予約システムの主な要件

・予約システムを最初に利用する際には、氏名、住所、郵便番号を入力し、利用者登録を行う。

・利用者は空き部屋照会のための条件入力の画面上で、チェックインとチェックアウトの日付、予約したい部屋の種別と部屋数を指定して空き状況を照会する。

・予約は部屋の種別ごとに行う。


#### 予約システムのE-R図
![ホテル予約システムのE-R図](/images/2021年/10月/hotel_mini.svg)

## Laravelの開発の基本的な進め方
要件定義によって作成されたE-R図に従い作成していきます。１つのテーブル（表）に対して、

テーブル → モデル（Model） → コントローラー（Controller） → （ルーティング） → ビュー（View） の順に作成していくと良いでしょう。

以下では、一番簡単な利用者テーブルの作成から利用者登録のフォーム作成までを行ってみます。

### 1.E-R図に従ってテーブルをマイグレーションファイル（create_users_table.php）で作成する。

```terminal
php artisan make:migrate create_users_table
```
ファイル名を<red>create_◯◯◯◯_table</red>という形（〇〇〇〇はテーブル名で複数形の単語）で指定してください。

こうすることで、Laravelは必要な事項をある程度埋めたマイグレーションファイルのテンプレートを作成してくれます。

基本的にLaravelで開発を行う際は、Laravelの推奨するルールに従っておくとLaravelが色々忖度してくれて開発がスムーズに進むことが多いです。

ここで<red>テーブル名の◯◯◯◯を複数形にする</red>のもLaravelの推奨するルールです。複数形ではない名前をつけることは可能ですが、その場合は１つ追加で設定する必要が生じます。<bold>楽をしたいならLaravelを信じてルールに従いましょう。</bold>

上記のコマンドで作成したマイグレーションファイルに、下記のように追記を行います。

#### create_users_table.php
```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateUsersTable extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::create('users', function (Blueprint $table) {
            $table->increments('id');
            $table->string('name');
            $table->string('address');
            $table->string('tel');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::dropIfExists('users');
    }
}
```

入力が完了すれば、マイグレーションを実行します。

```terminal
php artisan maigrate
```

### 1.1 ダミーデータをSeeder（UsersTableSeeder.php）で作成する。
Seederはテーブルに対してダミーデータを追加することができます。

利用方法はまず下記のコマンドで生成して、
```terminal
php artisan make:seeder UsersTableSeeder
```

run()メソッド内に、テーブルに追加したい内容を記載し、

#### UsersTableSeeder.php
```php
<?php

use Illuminate\Database\Seeder;

class UsersTableSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
        $param = [
            'name' => 'taro',
            'address' => '大阪府大阪市',
            'tel' => '00-1111-2222'
        ];
        DB::table('users')->insert($param);

        $param = [
            'name' => 'jiro',
            'address' => '京都府京都市',
            'tel' => '33-4444-5555'
        ];
        DB::table('users')->insert($param);
    }
}
```

DatabaseSeeder.phpに今書いたファイル名を登録します。

#### DatabaseSeeder.php
```php
<?php

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     *
     * @return void
     */
    public function run()
    {
        $this->call(UsersTableSeeder::class);
    }
}

```

最後にターミナルでSeederを実行します。

```terminal
php artisan db:seed
```

### 2.モデル（UserModel.php）を作成する。
どんどん行きましょう。次はモデルを追加します。

Usersテーブルに対して、その<red>単数形のUserモデル</red>とします。
（LaravelのデフォルトでUser.phpというモデルが作られていますが、それは削除します）

```terminal
php artisan make:model User
```

モデルはテーブルから取り出したデータに対しての操作を記述できますが、とりあえずデフォルトで良いです。

#### User.php
```php
<?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    //
}

```

### 3.コントローラー（UserController.php）を作成する。
コントローラーを作成します。Userモデルと繋がるので、<red>UserController</red>です。

```terminal
php artisan make:controller UserController
```

#### UserController.php
```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\User;

class UserController extends Controller
{
    public function index()
    {
        $items = User::all();

        return view('user.index',['item' => $items]);
    }
}

```

### 3.1 コントローラーにルーティング（web.php）を指定する。

### 4.ビュー（User/index.blade.php）を作成する。

（後日追記）