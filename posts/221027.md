---
title: "AWS Amplify + React + TypeScript + vite の環境構築で困ったところ"
date: "2022-10-27"
image: '/images/2022年/10月/awsamp.jpg'
metaDescription: 'Web APIについて説明し、天気予報APIから今日のデータを取得してみます'
tags: 
- 'JavaScript'
- 'React'
- 'AWS'
---

## AWS Amplify について

<red>API(Application Programable Interface)</red> とは、プログラムを使って、外部のOSやソフトウェアを利用できるようにした仕組みのことを指します。

例えば、「Windows API」というものを利用することで、プログラムから簡単にWindowsのファイルシステムを操作することができます。

このうち、<red><bold>Web API</bold></red>というものは、このAPIのやりとりをHTTP/HTTPSベースで実現することを指します。

HTTPの<yellow>Getメソッド</yellow>や<yellow>Postメソッド</yellow>などを決められた規則に従って利用することで、相手の<yellow>API サーバー</yellow>から、データを取得したり登録することができます。


JavaScriptでは、このようなWeb APIを利用するときには、 <red>非同期処理</red>というものが利用されます。

歴史的な経緯から非同期処理を実現する方法がいくつか存在しますが、最新の<red>async/awiat(エィシンク/アウェイト)</red> を使用してみます。

## とりあえず fetch と async と await を使ってみる。

Web APIの分かりやすい例として、気象庁のWeb APIから今日の天気予報のデータを取得してみます。

(実際は公式のAPIサービスというわけではなく、リクエストしたら JSON データが取得できる状態だそうです。)

参考：[気象庁の天気予報JSONファイルをWebAPI的に利用したサンプルアプリ](https://anko.education/apps/weather_api)


JavaScriptで外部からデータを取得するには、非同期処理と一緒に、<code>fetch()</code>メソッドというものを利用します。


```html
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body></body>
  <script>
    // API配信のURL
    // 130000は東京のエリアコード

    const url_Tokyo = "https://www.jma.go.jp/bosai/forecast/data/overview_forecast/130000.json"

    const getWeather = async (url) => {
        // 指定したurlのAPIからjsonデータを取得
        const response = await fetch(url)
        // jsonデータをオブジェクトに変換する
        return response.json()
    }

    const getData = async () => {
        const data = await getWeather(url_Tokyo);
        console.log(data);
        console.log(data.publishingOffice);
        console.log(data.reportDatetime);
        console.log(data.targetArea);
        console.log(data.text);
        
    }

    getData()
  </script>
</html>
```

下記のような天気予報の概要が取得できます。現在は梅雨です。

![天気予報サンプル](/images/2021年/6月/tenkiyoho.png)

## 非同期処理について

JavaScrip は **シングルスレッド** でのみ実行される言語です。<br/>
スレッドとは１つの処理の流れのブロックみたいなものです。<br/>
Java では **マルチスレッド** といって、複数のコードを並列して実行する機能がサポートされています。<br/>
マルチスレッドの機能が利用できると、メインの処理を１つのスレッドで動かす裏で、サーバーから画像や動画などのデータをダウンロードするという時間のかかる処理を別のスレッドで行うことができます。<br/>
しかし JavaScript はマルチスレッドが利用できません。そのため、同時に１つの処理しかできないため **データをダウンロードする** ような時間のかかる処理が始まると、別の処理がストップしてしまいます。<br/>

この問題に対処する仕組みが **非同期処理** です。<br/>

ちなみに _addEventListener("click",function(){})_ で定義されるイベント処理は非同期処理の一種になります。<br/>
